{"ast":null,"code":"var _jsxFileName = \"/home/alexkhan/Documents/meet-friends/frontend/src/components/userPanel/userpanel.js\";\nimport React, { Component, Fragment } from 'react';\nimport firebase from \"../../Auth/firebase\";\nimport AvatarEditor from \"react-avatar-editor\"; // prettier-ignore\n\nimport { Grid, Header, Icon, Dropdown, Image, Modal, Input, Button } from \"semantic-ui-react\";\nimport store from \"../../redux/store/store\";\nimport { SET_UNAUTHENTICATED } from \"../../redux/store/types\"; // import Button from \"@material-ui/core/Button\"\n\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\n\nclass userpanel extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      user: this.props.currentUser,\n      modal: false,\n      previewImage: \"\",\n      croppedImage: \"\",\n      blob: null,\n      uploadedCroppedImage: \"\",\n      storageRef: firebase.storage().ref(),\n      userRef: firebase.auth().currentUser,\n      usersRef: firebase.database().ref(\"users\"),\n      metadata: {\n        contentType: \"image/jpeg\"\n      }\n    };\n\n    this.openModal = () => this.setState({\n      modal: true\n    });\n\n    this.closeModal = () => this.setState({\n      modal: false\n    });\n\n    this.dropdownOptions = () => [{\n      key: \"user\",\n      text: /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 34,\n          columnNumber: 28\n        }\n      }, \"Signed as \", /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 34,\n          columnNumber: 45\n        }\n      }, this.state.user ? /*#__PURE__*/React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 24\n        }\n      }, this.state.user.username.toLowerCase()) : /*#__PURE__*/React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 88\n        }\n      }))),\n      disabled: true\n    }, {\n      key: \"avatar\",\n      text: /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 39,\n          columnNumber: 30\n        }\n      }, \"Change Avatar\")\n    }, {\n      key: \"signout\",\n      text: /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40,\n          columnNumber: 32\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        onClick: this.handleSignout,\n        type: \"submit\",\n        variant: \"contained\",\n        className: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40,\n          columnNumber: 38\n        }\n      }, \"SignOut\"))\n    }];\n\n    this.handleSignout = () => {\n      firebase.auth().signOut().then(() => {\n        store.dispatch({\n          type: SET_UNAUTHENTICATED\n        });\n      });\n    };\n\n    this.uploadCroppedImage = () => {\n      const {\n        storageRef,\n        userRef,\n        blob,\n        metadata\n      } = this.state;\n      storageRef.child(`avatars/users/${userRef.uid}`).put(blob, metadata).then(snap => {\n        snap.ref.getDownloadURL().then(downloadURL => {\n          this.setState({\n            uploadedCroppedImage: downloadURL\n          }, () => this.changeAvatar());\n        });\n      });\n    };\n\n    this.changeAvatar = () => {\n      this.state.userRef.updateProfile({\n        photoURL: this.state.uploadedCroppedImage\n      }).then(() => {\n        console.log(\"PhotoURL updated\");\n        this.closeModal();\n      }).catch(err => {\n        console.error(err);\n      });\n      this.state.usersRef.child(this.state.user.uid).update({\n        avatar: this.state.uploadedCroppedImage\n      }).then(() => {\n        console.log(\"User avatar updated\");\n      }).catch(err => {\n        console.error(err);\n      });\n    };\n\n    this.handleChange = event => {\n      const file = event.target.files[0];\n      const reader = new FileReader();\n\n      if (file) {\n        reader.readAsDataURL(file);\n        reader.addEventListener(\"load\", () => {\n          this.setState({\n            previewImage: reader.result\n          });\n        });\n      }\n    };\n\n    this.handleCropImage = () => {\n      if (this.avatarEditor) {\n        this.avatarEditor.getImageScaledToCanvas().toBlob(blob => {\n          let imageUrl = URL.createObjectURL(blob);\n          this.setState({\n            croppedImage: imageUrl,\n            blob\n          });\n        });\n      }\n    };\n\n    this.handleSignout = () => {\n      firebase.auth().signOut().then(() => console.log(\"signed out!\"));\n    };\n  }\n\n  render() {\n    const {\n      user,\n      modal,\n      previewImage,\n      croppedImage\n    } = this.state;\n    const {\n      primaryColor\n    } = this.props;\n    return /*#__PURE__*/React.createElement(Grid, {\n      style: {\n        background: primaryColor\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Row, {\n      style: {\n        padding: \"1.2em\",\n        margin: 0\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      inverted: true,\n      floated: \"left\",\n      as: \"h2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      name: \"code\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(Header.Content, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 19\n      }\n    }, \"DevChat\")), /*#__PURE__*/React.createElement(Header, {\n      style: {\n        padding: \"0.25em\"\n      },\n      as: \"h4\",\n      inverted: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Dropdown, {\n      className: \"dropdown\",\n      trigger: /*#__PURE__*/React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 32\n        }\n      }, user ? /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Image, {\n        src: user.profileImage,\n        spaced: \"right\",\n        avatar: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 33\n        }\n      }), user.username) : /*#__PURE__*/React.createElement(CircularProgress, {\n        size: 20,\n        disableShrink: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 37\n        }\n      })),\n      options: this.dropdownOptions(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(Modal, {\n      basic: true,\n      open: modal,\n      onClose: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 17\n      }\n    }, \"Change Avatar\"), /*#__PURE__*/React.createElement(Modal.Content, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      onChange: this.handleChange,\n      fluid: true,\n      type: \"file\",\n      label: \"New Avatar\",\n      name: \"previewImage\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(Grid, {\n      centered: true,\n      stackable: true,\n      columns: 2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Row, {\n      centered: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Grid.Column, {\n      className: \"ui center aligned grid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 23\n      }\n    }, previewImage && /*#__PURE__*/React.createElement(AvatarEditor, {\n      ref: node => this.avatarEditor = node,\n      image: previewImage,\n      width: 120,\n      height: 120,\n      border: 50,\n      scale: 1.2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 27\n      }\n    })), /*#__PURE__*/React.createElement(Grid.Column, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 23\n      }\n    }, croppedImage && /*#__PURE__*/React.createElement(Image, {\n      style: {\n        margin: \"3.5em auto\"\n      },\n      width: 100,\n      height: 100,\n      src: croppedImage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 27\n      }\n    }))))), /*#__PURE__*/React.createElement(Modal.Actions, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 17\n      }\n    }, croppedImage && /*#__PURE__*/React.createElement(Button, {\n      color: \"green\",\n      inverted: true,\n      onClick: this.uploadCroppedImage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      name: \"save\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 23\n      }\n    }), \" Change Avatar\"), /*#__PURE__*/React.createElement(Button, {\n      color: \"green\",\n      inverted: true,\n      onClick: this.handleCropImage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      name: \"image\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 21\n      }\n    }), \" Preview\"), /*#__PURE__*/React.createElement(Button, {\n      color: \"red\",\n      inverted: true,\n      onClick: this.closeModal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      name: \"remove\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 21\n      }\n    }), \" Cancel\")))));\n  }\n\n} // const mapStateToProps =(state) => ({\n//     user: state.user\n// })\n\n\nexport default userpanel;","map":{"version":3,"sources":["/home/alexkhan/Documents/meet-friends/frontend/src/components/userPanel/userpanel.js"],"names":["React","Component","Fragment","firebase","AvatarEditor","Grid","Header","Icon","Dropdown","Image","Modal","Input","Button","store","SET_UNAUTHENTICATED","CircularProgress","userpanel","state","user","props","currentUser","modal","previewImage","croppedImage","blob","uploadedCroppedImage","storageRef","storage","ref","userRef","auth","usersRef","database","metadata","contentType","openModal","setState","closeModal","dropdownOptions","key","text","username","toLowerCase","disabled","handleSignout","signOut","then","dispatch","type","uploadCroppedImage","child","uid","put","snap","getDownloadURL","downloadURL","changeAvatar","updateProfile","photoURL","console","log","catch","err","error","update","avatar","handleChange","event","file","target","files","reader","FileReader","readAsDataURL","addEventListener","result","handleCropImage","avatarEditor","getImageScaledToCanvas","toBlob","imageUrl","URL","createObjectURL","render","primaryColor","background","padding","margin","profileImage","node"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,OAAOC,QAAP,MAAqB,qBAArB;AACA,OAAOC,YAAP,MAAyB,qBAAzB,C,CACA;;AACA,SAASC,IAAT,EAAeC,MAAf,EAAuBC,IAAvB,EAA6BC,QAA7B,EAAuCC,KAAvC,EAA8CC,KAA9C,EAAqDC,KAArD,EAA4DC,MAA5D,QAA0E,mBAA1E;AACA,OAAOC,KAAP,MAAkB,yBAAlB;AACA,SAAQC,mBAAR,QAAkC,yBAAlC,C,CACA;;AACA,OAAOC,gBAAP,MAA6B,oCAA7B;;AAIA,MAAMC,SAAN,SAAwBf,SAAxB,CAAkC;AAAA;AAAA;AAAA,SAC9BgB,KAD8B,GACtB;AACJC,MAAAA,IAAI,EAAE,KAAKC,KAAL,CAAWC,WADb;AAEJC,MAAAA,KAAK,EAAE,KAFH;AAGJC,MAAAA,YAAY,EAAE,EAHV;AAIJC,MAAAA,YAAY,EAAE,EAJV;AAKJC,MAAAA,IAAI,EAAE,IALF;AAMJC,MAAAA,oBAAoB,EAAE,EANlB;AAOJC,MAAAA,UAAU,EAAEvB,QAAQ,CAACwB,OAAT,GAAmBC,GAAnB,EAPR;AAQJC,MAAAA,OAAO,EAAE1B,QAAQ,CAAC2B,IAAT,GAAgBV,WARrB;AASJW,MAAAA,QAAQ,EAAE5B,QAAQ,CAAC6B,QAAT,GAAoBJ,GAApB,CAAwB,OAAxB,CATN;AAUJK,MAAAA,QAAQ,EAAE;AACRC,QAAAA,WAAW,EAAE;AADL;AAVN,KADsB;;AAAA,SAgB5BC,SAhB4B,GAgBhB,MAAM,KAAKC,QAAL,CAAc;AAAEf,MAAAA,KAAK,EAAE;AAAT,KAAd,CAhBU;;AAAA,SAkB5BgB,UAlB4B,GAkBf,MAAM,KAAKD,QAAL,CAAc;AAAEf,MAAAA,KAAK,EAAE;AAAT,KAAd,CAlBS;;AAAA,SAoB5BiB,eApB4B,GAoBV,MAAM,CACtB;AAAEC,MAAAA,GAAG,EAAC,MAAN;AAAaC,MAAAA,IAAI,eAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEvC,KAAKvB,KAAL,CAAWC,IAAX,gBAAkB,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAW,KAAKD,KAAL,CAAWC,IAAX,CAAgBuB,QAAhB,CAAyBC,WAAzB,EAAX,CAAlB,gBAAkF,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAF3C,CAAjB,CAAnB;AAIqBC,MAAAA,QAAQ,EAAE;AAJ/B,KADsB,EAMtB;AAACJ,MAAAA,GAAG,EAAE,QAAN;AAAeC,MAAAA,IAAI,eAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAArB,KANsB,EAOtB;AAAED,MAAAA,GAAG,EAAE,SAAP;AAAiBC,MAAAA,IAAI,eAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAM,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKI,aAAtB;AAAsC,QAAA,IAAI,EAAC,QAA3C;AAAoD,QAAA,OAAO,EAAC,WAA5D;AAAwE,QAAA,SAAS,EAAC,QAAlF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAN;AAAvB,KAPsB,CApBI;;AAAA,SA6B9BA,aA7B8B,GA6Bf,MAAK;AAChBzC,MAAAA,QAAQ,CAAC2B,IAAT,GAAgBe,OAAhB,GAA0BC,IAA1B,CAA+B,MAAK;AAChCjC,QAAAA,KAAK,CAACkC,QAAN,CAAe;AAACC,UAAAA,IAAI,EAAElC;AAAP,SAAf;AAGH,OAJD;AAKH,KAnC6B;;AAAA,SAqC5BmC,kBArC4B,GAqCP,MAAM;AACzB,YAAM;AAAEvB,QAAAA,UAAF;AAAcG,QAAAA,OAAd;AAAuBL,QAAAA,IAAvB;AAA6BS,QAAAA;AAA7B,UAA0C,KAAKhB,KAArD;AAEAS,MAAAA,UAAU,CACPwB,KADH,CACU,iBAAgBrB,OAAO,CAACsB,GAAI,EADtC,EAEGC,GAFH,CAEO5B,IAFP,EAEaS,QAFb,EAGGa,IAHH,CAGQO,IAAI,IAAI;AACZA,QAAAA,IAAI,CAACzB,GAAL,CAAS0B,cAAT,GAA0BR,IAA1B,CAA+BS,WAAW,IAAI;AAC5C,eAAKnB,QAAL,CAAc;AAAEX,YAAAA,oBAAoB,EAAE8B;AAAxB,WAAd,EAAqD,MACnD,KAAKC,YAAL,EADF;AAGD,SAJD;AAKD,OATH;AAUD,KAlD2B;;AAAA,SAoD5BA,YApD4B,GAoDb,MAAM;AACnB,WAAKvC,KAAL,CAAWY,OAAX,CACG4B,aADH,CACiB;AACbC,QAAAA,QAAQ,EAAE,KAAKzC,KAAL,CAAWQ;AADR,OADjB,EAIGqB,IAJH,CAIQ,MAAM;AACVa,QAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACA,aAAKvB,UAAL;AACD,OAPH,EAQGwB,KARH,CAQSC,GAAG,IAAI;AACZH,QAAAA,OAAO,CAACI,KAAR,CAAcD,GAAd;AACD,OAVH;AAYA,WAAK7C,KAAL,CAAWc,QAAX,CACGmB,KADH,CACS,KAAKjC,KAAL,CAAWC,IAAX,CAAgBiC,GADzB,EAEGa,MAFH,CAEU;AAAEC,QAAAA,MAAM,EAAE,KAAKhD,KAAL,CAAWQ;AAArB,OAFV,EAGGqB,IAHH,CAGQ,MAAM;AACVa,QAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACD,OALH,EAMGC,KANH,CAMSC,GAAG,IAAI;AACZH,QAAAA,OAAO,CAACI,KAAR,CAAcD,GAAd;AACD,OARH;AASD,KA1E2B;;AAAA,SA4E5BI,YA5E4B,GA4EbC,KAAK,IAAI;AACtB,YAAMC,IAAI,GAAGD,KAAK,CAACE,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAb;AACA,YAAMC,MAAM,GAAG,IAAIC,UAAJ,EAAf;;AAEA,UAAIJ,IAAJ,EAAU;AACRG,QAAAA,MAAM,CAACE,aAAP,CAAqBL,IAArB;AACAG,QAAAA,MAAM,CAACG,gBAAP,CAAwB,MAAxB,EAAgC,MAAM;AACpC,eAAKtC,QAAL,CAAc;AAAEd,YAAAA,YAAY,EAAEiD,MAAM,CAACI;AAAvB,WAAd;AACD,SAFD;AAGD;AACF,KAtF2B;;AAAA,SAwF5BC,eAxF4B,GAwFV,MAAM;AACtB,UAAI,KAAKC,YAAT,EAAuB;AACrB,aAAKA,YAAL,CAAkBC,sBAAlB,GAA2CC,MAA3C,CAAkDvD,IAAI,IAAI;AACxD,cAAIwD,QAAQ,GAAGC,GAAG,CAACC,eAAJ,CAAoB1D,IAApB,CAAf;AACA,eAAKY,QAAL,CAAc;AACZb,YAAAA,YAAY,EAAEyD,QADF;AAEZxD,YAAAA;AAFY,WAAd;AAID,SAND;AAOD;AACF,KAlG2B;;AAAA,SAoG5BoB,aApG4B,GAoGZ,MAAM;AACpBzC,MAAAA,QAAQ,CACL2B,IADH,GAEGe,OAFH,GAGGC,IAHH,CAGQ,MAAMa,OAAO,CAACC,GAAR,CAAY,aAAZ,CAHd;AAID,KAzG2B;AAAA;;AA2G5BuB,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEjE,MAAAA,IAAF;AAAQG,MAAAA,KAAR;AAAeC,MAAAA,YAAf;AAA6BC,MAAAA;AAA7B,QAA8C,KAAKN,KAAzD;AACA,UAAM;AAAEmE,MAAAA;AAAF,QAAmB,KAAKjE,KAA9B;AAEA,wBACE,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AAAEkE,QAAAA,UAAU,EAAED;AAAd,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,MAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,GAAN;AAAU,MAAA,KAAK,EAAE;AAAEE,QAAAA,OAAO,EAAE,OAAX;AAAoBC,QAAAA,MAAM,EAAE;AAA5B,OAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAEE,oBAAC,MAAD;AAAQ,MAAA,QAAQ,MAAhB;AAAiB,MAAA,OAAO,EAAC,MAAzB;AAAgC,MAAA,EAAE,EAAC,IAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAC,MAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAEE,oBAAC,MAAD,CAAQ,OAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAFF,CAFF,eAQE,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAE;AAAED,QAAAA,OAAO,EAAE;AAAX,OAAf;AAAsC,MAAA,EAAE,EAAC,IAAzC;AAA8C,MAAA,QAAQ,MAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,oBAAC,QAAD;AACQ,MAAA,SAAS,EAAC,UADlB;AAEQ,MAAA,OAAO,eAEA,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACEpE,IAAI,gBACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACA,oBAAC,KAAD;AAAO,QAAA,GAAG,EAAEA,IAAI,CAACsE,YAAjB;AAA+B,QAAA,MAAM,EAAC,OAAtC;AAA8C,QAAA,MAAM,MAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADA,EAGCtE,IAAI,CAACuB,QAHN,CADK,gBAOD,oBAAC,gBAAD;AAAkB,QAAA,IAAI,EAAE,EAAxB;AAA4B,QAAA,aAAa,MAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARL,CAJf;AAiBY,MAAA,OAAO,EAAE,KAAKH,eAAL,EAjBrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADA,CARF,CADF,eAiCE,oBAAC,KAAD;AAAO,MAAA,KAAK,MAAZ;AAAa,MAAA,IAAI,EAAEjB,KAAnB;AAA0B,MAAA,OAAO,EAAE,KAAKgB,UAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,KAAD,CAAO,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,eAEE,oBAAC,KAAD,CAAO,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,KAAD;AACE,MAAA,QAAQ,EAAE,KAAK6B,YADjB;AAEE,MAAA,KAAK,MAFP;AAGE,MAAA,IAAI,EAAC,MAHP;AAIE,MAAA,KAAK,EAAC,YAJR;AAKE,MAAA,IAAI,EAAC,cALP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAQE,oBAAC,IAAD;AAAM,MAAA,QAAQ,MAAd;AAAe,MAAA,SAAS,MAAxB;AAAyB,MAAA,OAAO,EAAE,CAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,GAAN;AAAU,MAAA,QAAQ,MAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD,CAAM,MAAN;AAAa,MAAA,SAAS,EAAC,wBAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG5C,YAAY,iBACX,oBAAC,YAAD;AACE,MAAA,GAAG,EAAEmE,IAAI,IAAK,KAAKZ,YAAL,GAAoBY,IADpC;AAEE,MAAA,KAAK,EAAEnE,YAFT;AAGE,MAAA,KAAK,EAAE,GAHT;AAIE,MAAA,MAAM,EAAE,GAJV;AAKE,MAAA,MAAM,EAAE,EALV;AAME,MAAA,KAAK,EAAE,GANT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFJ,CADF,eAaE,oBAAC,IAAD,CAAM,MAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGC,YAAY,iBACX,oBAAC,KAAD;AACE,MAAA,KAAK,EAAE;AAAEgE,QAAAA,MAAM,EAAE;AAAV,OADT;AAEE,MAAA,KAAK,EAAE,GAFT;AAGE,MAAA,MAAM,EAAE,GAHV;AAIE,MAAA,GAAG,EAAEhE,YAJP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFJ,CAbF,CADF,CARF,CAFF,eAqCE,oBAAC,KAAD,CAAO,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGA,YAAY,iBACX,oBAAC,MAAD;AACE,MAAA,KAAK,EAAC,OADR;AAEE,MAAA,QAAQ,MAFV;AAGE,MAAA,OAAO,EAAE,KAAK0B,kBAHhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAKE,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAC,MAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MALF,mBAFJ,eAUE,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAC,OAAd;AAAsB,MAAA,QAAQ,MAA9B;AAA+B,MAAA,OAAO,EAAE,KAAK2B,eAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAC,OAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,aAVF,eAaE,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAC,KAAd;AAAoB,MAAA,QAAQ,MAA5B;AAA6B,MAAA,OAAO,EAAE,KAAKvC,UAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAC,QAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,YAbF,CArCF,CAjCF,CADF,CADF;AA6FD;;AA5M2B,C,CA+MlC;AACA;AACA;;;AAEA,eAAgBrB,SAAhB","sourcesContent":["import React, { Component, Fragment } from 'react'\nimport firebase from \"../../Auth/firebase\"\nimport AvatarEditor from \"react-avatar-editor\";\n// prettier-ignore\nimport { Grid, Header, Icon, Dropdown, Image, Modal, Input, Button } from \"semantic-ui-react\";\nimport store from \"../../redux/store/store\"\nimport {SET_UNAUTHENTICATED} from \"../../redux/store/types\"\n// import Button from \"@material-ui/core/Button\"\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\n\n\n\nclass userpanel extends Component {\n    state = {\n        user: this.props.currentUser,\n        modal: false,\n        previewImage: \"\",\n        croppedImage: \"\",\n        blob: null,\n        uploadedCroppedImage: \"\",\n        storageRef: firebase.storage().ref(),\n        userRef: firebase.auth().currentUser,\n        usersRef: firebase.database().ref(\"users\"),\n        metadata: {\n          contentType: \"image/jpeg\"\n        }\n      };\n    \n      openModal = () => this.setState({ modal: true });\n    \n      closeModal = () => this.setState({ modal: false });\n    \n      dropdownOptions = () => [\n        { key:\"user\",text: <span >Signed as <strong>\n            \n    {this.state.user ?(<Fragment>{this.state.user.username.toLowerCase()}</Fragment>):(<Fragment/>)}\n            \n            </strong></span>,disabled: true},\n        {key: \"avatar\",text: <span>Change Avatar</span> },\n        { key: \"signout\",text: <span><Button onClick={this.handleSignout } type=\"submit\" variant=\"contained\" className=\"button\">SignOut</Button></span>}\n    ]\n    handleSignout =()=> {\n        firebase.auth().signOut().then(()=> {\n            store.dispatch({type: SET_UNAUTHENTICATED\n            })\n            \n        })\n    }\n    \n      uploadCroppedImage = () => {\n        const { storageRef, userRef, blob, metadata } = this.state;\n    \n        storageRef\n          .child(`avatars/users/${userRef.uid}`)\n          .put(blob, metadata)\n          .then(snap => {\n            snap.ref.getDownloadURL().then(downloadURL => {\n              this.setState({ uploadedCroppedImage: downloadURL }, () =>\n                this.changeAvatar()\n              );\n            });\n          });\n      };\n    \n      changeAvatar = () => {\n        this.state.userRef\n          .updateProfile({\n            photoURL: this.state.uploadedCroppedImage\n          })\n          .then(() => {\n            console.log(\"PhotoURL updated\");\n            this.closeModal();\n          })\n          .catch(err => {\n            console.error(err);\n          });\n    \n        this.state.usersRef\n          .child(this.state.user.uid)\n          .update({ avatar: this.state.uploadedCroppedImage })\n          .then(() => {\n            console.log(\"User avatar updated\");\n          })\n          .catch(err => {\n            console.error(err);\n          });\n      };\n    \n      handleChange = event => {\n        const file = event.target.files[0];\n        const reader = new FileReader();\n    \n        if (file) {\n          reader.readAsDataURL(file);\n          reader.addEventListener(\"load\", () => {\n            this.setState({ previewImage: reader.result });\n          });\n        }\n      };\n    \n      handleCropImage = () => {\n        if (this.avatarEditor) {\n          this.avatarEditor.getImageScaledToCanvas().toBlob(blob => {\n            let imageUrl = URL.createObjectURL(blob);\n            this.setState({\n              croppedImage: imageUrl,\n              blob\n            });\n          });\n        }\n      };\n    \n      handleSignout = () => {\n        firebase\n          .auth()\n          .signOut()\n          .then(() => console.log(\"signed out!\"));\n      };\n    \n      render() {\n        const { user, modal, previewImage, croppedImage } = this.state;\n        const { primaryColor } = this.props;\n    \n        return (\n          <Grid style={{ background: primaryColor }}>\n            <Grid.Column>\n              <Grid.Row style={{ padding: \"1.2em\", margin: 0 }}>\n                {/* App Header */}\n                <Header inverted floated=\"left\" as=\"h2\">\n                  <Icon name=\"code\" />\n                  <Header.Content>DevChat</Header.Content>\n                </Header>\n    \n                {/* User Dropdown  */}\n                <Header style={{ padding: \"0.25em\" }} as=\"h4\" inverted>\n                <Dropdown \n                        className=\"dropdown\"\n                        trigger={\n\n                               <Fragment>\n                                {user ? (\n                                <span>\n                                <Image src={user.profileImage} spaced=\"right\" avatar />\n\n                                {user.username}\n                                </span> \n                                ):(\n                                    <CircularProgress size={20} disableShrink />\n                                )}\n                               </Fragment>\n                           \n                        }\n                            options={this.dropdownOptions()}\n                        />\n                </Header>\n              </Grid.Row>\n    \n              {/* Change User Avatar Modal   */}\n              <Modal basic open={modal} onClose={this.closeModal}>\n                <Modal.Header>Change Avatar</Modal.Header>\n                <Modal.Content>\n                  <Input\n                    onChange={this.handleChange}\n                    fluid\n                    type=\"file\"\n                    label=\"New Avatar\"\n                    name=\"previewImage\"\n                  />\n                  <Grid centered stackable columns={2}>\n                    <Grid.Row centered>\n                      <Grid.Column className=\"ui center aligned grid\">\n                        {previewImage && (\n                          <AvatarEditor\n                            ref={node => (this.avatarEditor = node)}\n                            image={previewImage}\n                            width={120}\n                            height={120}\n                            border={50}\n                            scale={1.2}\n                          />\n                        )}\n                      </Grid.Column>\n                      <Grid.Column>\n                        {croppedImage && (\n                          <Image\n                            style={{ margin: \"3.5em auto\" }}\n                            width={100}\n                            height={100}\n                            src={croppedImage}\n                          />\n                        )}\n                      </Grid.Column>\n                    </Grid.Row>\n                  </Grid>\n                </Modal.Content>\n                <Modal.Actions>\n                  {croppedImage && (\n                    <Button\n                      color=\"green\"\n                      inverted\n                      onClick={this.uploadCroppedImage}\n                    >\n                      <Icon name=\"save\" /> Change Avatar\n                    </Button>\n                  )}\n                  <Button color=\"green\" inverted onClick={this.handleCropImage}>\n                    <Icon name=\"image\" /> Preview\n                  </Button>\n                  <Button color=\"red\" inverted onClick={this.closeModal}>\n                    <Icon name=\"remove\" /> Cancel\n                  </Button>\n                </Modal.Actions>\n              </Modal>\n            </Grid.Column>\n          </Grid>\n        );\n      }\n}\n\n// const mapStateToProps =(state) => ({\n//     user: state.user\n// })\n\nexport default  userpanel\n"]},"metadata":{},"sourceType":"module"}