{"ast":null,"code":"var _jsxFileName = \"/home/alexkhan/Documents/meet-friends/frontend/src/components/messages/Messages.js\";\nimport React, { Component, Fragment } from 'react';\nimport { Segment, Comment } from \"semantic-ui-react\";\nimport MessagesHeader from \"./messageHeader\";\nimport MessageForm from \"./messageForm\";\nimport firebase from \"../../Auth/firebase\";\nimport Message from \"./Message\";\nimport Spinner from \"../spinner/spinner\";\n\nclass Messages extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      messagesRef: firebase.database().ref('messages'),\n      channel: this.props.currentChannel,\n      currentUser: this.props.currentUser,\n      messages: [],\n      loading: true,\n      numUniqueUsers: \"\",\n      searchTerm: \"\",\n      searchLoading: false,\n      searchResults: []\n    };\n\n    this.addListeners = channelId => {\n      this.addMessageListener(channelId);\n    };\n\n    this.addMessageListener = channelId => {\n      let loadedMessages = [];\n      this.state.messagesRef.child(channelId).on(\"child_added\", snap => {\n        loadedMessages.push(snap.val());\n        this.setState({\n          messages: loadedMessages,\n          loading: false\n        });\n      });\n      this.countUniqueUsers(loadedMessages);\n    };\n\n    this.countUniqueUsers = messages => {\n      const uniqueUsers = messages.reduce((acc, message) => {\n        if (!acc.includes(message.user.name)) {\n          acc.push(message.user.username);\n        }\n\n        return acc;\n      }, []);\n      const numUniqueUsers = `${uniqueUsers.length} user${uniqueUsers.length > 1 ? \"s\" : \"\"}`;\n      this.setState({\n        numUniqueUsers: numUniqueUsers\n      });\n    };\n\n    this.displayMessages = messages => messages.length > 0 ? messages.map(message => /*#__PURE__*/React.createElement(Message, {\n      key: message.timestamp,\n      message: message,\n      user: this.state.currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 13\n      }\n    })) : /*#__PURE__*/React.createElement(Spinner, {\n      messages: messages,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 12\n      }\n    });\n\n    this.displayChannelName = channel => channel ? `${channel.name}` : \"\";\n\n    this.handleSearch = event => {\n      this.setState({\n        searchTerm: event.target.value,\n        searchLoading: true\n      }, () => {\n        this.handleSearchMessages();\n      });\n    };\n\n    this.handleSearchMessages = () => {\n      const channelMessages = [...this.state.messages];\n      const regex = new RegExp(this.state.searchTerm, 'gi');\n      const searchResults = channelMessages.reduce((acc, message) => {\n        if (message.content && message.content.match(regex) || message.user.name.match(regex)) {\n          acc.push(message);\n        }\n\n        return acc;\n      }, []);\n      this.setState({\n        searchResults: searchResults\n      });\n      setTimeout(() => this.setState({\n        searchLoading: false\n      }), 1000);\n    };\n  }\n\n  componentDidMount() {\n    const {\n      channel,\n      currentUser\n    } = this.state;\n\n    if (channel && currentUser) {\n      this.addListeners(channel.id);\n    }\n  }\n\n  render() {\n    const {\n      messagesRef,\n      channel,\n      currentUser,\n      messages,\n      numUniqueUsers,\n      searchTerm,\n      searchResults,\n      searchLoading\n    } = this.state;\n    return /*#__PURE__*/React.createElement(Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(MessagesHeader, {\n      handleSearch: this.handleSearch,\n      channelName: this.displayChannelName(channel),\n      numUniqueUsers: numUniqueUsers,\n      searchLoading: searchLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 16\n      }\n    }), /*#__PURE__*/React.createElement(Segment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Comment.Group, {\n      className: \"messages\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 29\n      }\n    }, searchTerm ? this.displayMessages(searchResults) : this.displayMessages(messages))), /*#__PURE__*/React.createElement(MessageForm, {\n      messagesRef: messagesRef,\n      currentChannel: channel,\n      currentUser: currentUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 25\n      }\n    }));\n  }\n\n}\n\nexport default Messages;","map":{"version":3,"sources":["/home/alexkhan/Documents/meet-friends/frontend/src/components/messages/Messages.js"],"names":["React","Component","Fragment","Segment","Comment","MessagesHeader","MessageForm","firebase","Message","Spinner","Messages","state","messagesRef","database","ref","channel","props","currentChannel","currentUser","messages","loading","numUniqueUsers","searchTerm","searchLoading","searchResults","addListeners","channelId","addMessageListener","loadedMessages","child","on","snap","push","val","setState","countUniqueUsers","uniqueUsers","reduce","acc","message","includes","user","name","username","length","displayMessages","map","timestamp","displayChannelName","handleSearch","event","target","value","handleSearchMessages","channelMessages","regex","RegExp","content","match","setTimeout","componentDidMount","id","render"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react'\nimport { Segment, Comment } from \"semantic-ui-react\"\nimport MessagesHeader from \"./messageHeader\"\nimport MessageForm from \"./messageForm\"\nimport firebase from \"../../Auth/firebase\"\nimport Message from \"./Message\"\nimport Spinner from \"../spinner/spinner\"\n\nclass Messages extends Component {\n\n    state = {\n        messagesRef: firebase.database().ref('messages'),\n        channel: this.props.currentChannel,\n        currentUser: this.props.currentUser,\n        messages: [],\n        loading: true,\n        numUniqueUsers: \"\",\n        searchTerm: \"\",\n        searchLoading: false,\n        searchResults:[]\n    }\n\n    componentDidMount() {\n        const { channel, currentUser } = this.state\n        if (channel && currentUser) {\n            this.addListeners(channel.id)\n        }\n    }\n\n    addListeners = (channelId) => {\n        this.addMessageListener(channelId)\n    }\n\n    addMessageListener = (channelId) => {\n        let loadedMessages = []\n        this.state.messagesRef.child(channelId).on(\"child_added\", snap => {\n            loadedMessages.push(snap.val())\n            this.setState({ messages: loadedMessages, loading: false })\n        })\n        this.countUniqueUsers(loadedMessages)\n    }\n\n    countUniqueUsers =(messages)=> {\n        const uniqueUsers = messages.reduce((acc, message)=> {\n            if(!acc.includes(message.user.name)){\n                acc.push(message.user.username)\n            }\n            return acc\n        }, [])\n\n        const numUniqueUsers = `${uniqueUsers.length} user${uniqueUsers.length > 1 ? (\"s\"):(\"\")}`\n        this.setState({numUniqueUsers: numUniqueUsers})\n    }\n\n    displayMessages = (messages) => (\n        messages.length > 0 ? messages.map(message => (\n            <Message\n                key={message.timestamp}\n                message={message}\n                user={this.state.currentUser}\n            />\n        )):<Spinner\n            messages={messages}\n        />\n    )\n\n    displayChannelName = (channel) => channel ? `${channel.name}`: \"\"\n\n    handleSearch = (event) => {\n        this.setState({\n            searchTerm: event.target.value,\n            searchLoading: true\n        },\n        ()=>{\n            this.handleSearchMessages()\n        }\n        )\n    }\n    handleSearchMessages =()=> {\n        const channelMessages =[...this.state.messages] \n        const regex = new RegExp(this.state.searchTerm, 'gi')\n        const searchResults = channelMessages.reduce((acc, message)=>{\n             if(message.content && message.content.match(regex) || message.user.name.match(regex)){\n                 acc.push(message)\n             }\n             return acc\n        },[]);\n        this.setState({ searchResults:searchResults})\n        setTimeout(()=> this.setState({ searchLoading: false}),1000)\n    }\n\n    render() {\n        const { messagesRef, channel, currentUser, messages,numUniqueUsers,searchTerm,searchResults,searchLoading } = this.state\n        return (\n            <Fragment>\n               <MessagesHeader\n               handleSearch={this.handleSearch} \n               channelName={this.displayChannelName(channel)}\n               numUniqueUsers={numUniqueUsers}\n               searchLoading={searchLoading}\n               />\n                        <Segment>\n                            <Comment.Group className=\"messages\">\n                                {searchTerm ? this.displayMessages(searchResults): this.displayMessages(messages)}\n\n                            </Comment.Group>\n                        </Segment>\n                        <MessageForm\n                            messagesRef={messagesRef}\n                            currentChannel={channel}\n                            currentUser={currentUser}\n                        />\n            </Fragment>\n        )\n    }\n}\n\nexport default Messages\n"]},"metadata":{},"sourceType":"module"}